## Methods

Dogs were recruited by word of mouth in several locations between July and November 2022.
Breed organization registration of each dog was confirmed by manually viewing the dog's breed organization paperwork or locating the dog in the American Kennel Club (AKC) database.
Recruitment was structured to ensure full coverage of dog breeds across breed clades [@doi:10.1016/j.celrep.2017.03.079].
Each dog was randomized to either the control or treatment group, corresponding to the dog's own versus a randomized photo.
Dogs in the treatment group were paired based on their enrollment order, and the photographs were swapped across pairs.
Assignments were evaluated to ensure that dogs within a breed clade (per [@doi:10.1016/j.celrep.2017.03.079]) were not paired.
All enrolled dogs came from different households, avoiding the possibility of cross-contamination of dogs within the study.

The six DTC genetic tests (Table @tbl:tests) were purchased directly from each company's website.
Kits were registered according to the instructions provided, using the dog's own photograph (control) or the photograph of a paired dog (treatment).
When the information was requested, dogs were listed as mixed breed.
A set of kits was then delivered to each dog owner, who was instructed to collect buccal swabs for each according to manufacturer instructions and to mail the samples using the company-provided packaging.
Genetic testing was conducted by each DTC genetic testing company according to their own protocols.
The breed determination results were returned to the authors, who retrieved the results for each dog and recorded all results for the determined breeds and the corresponding percentage composition in a spreadsheet.
Breed results were harmonized across studies using the Vertebrate Breed Ontology version 20230601 [@doi:10.5281/zenodo.7996674].
If a breed assignment corresponded to a variety, rather than a breed, per the Federation Cynologique Internationale (FCI) [@url:https://www.fci.be], the corresponding breed (i.e., the parent term) was used instead. 
Qualitative assignments, such as ranges of percentages, were converted to numerical values for the purposes of data visualization (Supplementary Table XX).

**Comparison of six DTC dog genetic testing services.**
At the time of study design (end of 2021), six DTC dog genetic tests were available on the public market.
All six were included in this study.
Each test uses a distinct combination of genotyping technologies, breed classification algorithms, and reference panels.
While this study focuses on the methodologies, a detailed breakdown of consumer-oriented similarities and differences among several of these tests is available elsewhere [@url:https://www.caninejournal.com/dog-dna-tests-reviews].
{#tbl:tests}

| Test/Company Name                               | Price of Base Breed Test   | Markers Used                                                                                                                    | Reference Panel                                                                                                           | Ancestry Assignment Algorithm             |
|:------------------------------------------------|:---------------------------|:--------------------------------------------------------------------------------------------------------------------------------|:--------------------------------------------------------------------------------------------------------------------------|:------------------------------------------|
| Embark Breed ID DNA Test [@url:https://shop.embarkvet.com/products/embark-dog-dna-test-kit]       | $129-$199                  | 200,000+ SNPs, custom chip [@doi:10.1371/journal.pgen.1007648; @doi:10.1371/journal.pgen.1008003] including all markers 173k markers on the Illumina CanineHD platform [@doi:10.1534/g3.118.200836]                                                                       | 350+ breeds [@url:https://embarkvet.com/resources/dog-breeds]                                                                                                          | Not specified                             |
| Wisdom Panel Breed Discovery [@url:https://www.wisdompanel.com/en-us/dog-dna-tests/breed-discovery]                   | $80-$160                   | SNPs, number not specified, custom-designed Illumina Infinium XT microarray [@doi:10.1371/journal.pgen.1010651]                                                                     | 350+ breeds, 21,000+ samples [@url:https://www.wisdompanel.com/en-us/our-science; @doi:10.1371/journal.pgen.1010651] | BCSYS [@doi:10.1371/journal.pgen.1010651]                                     |
| Orivet GenoPet [@url:https://www.orivet.com/us/products/genopet-dog-breed-identification-dna-test]                                  | $95-160                    | SNPs, number not specified [@url:https://www.orivet.com/store/canine-mixed-breed-screen/geno-pet-dog-breed-identification-test] | 15,000 samples from 350+ breeds [@url:https://orivet.com/media/c4ca4238a0b923820dcc509a6f75849b/List%20of%20breeds.pdf]                                                                | Not specified                             |
| Darwin's Ark Explorer Level Donation [@url:https://darwinsark.org]           | $149 donation              | Call 9M SNPs from whole-genome sequencing, use 688K for breed classification [@url:https://darwinsark.org/faqs] | 101 breeds [@url:https://darwinsark.org/faq]                                                                                                               | SupportMix [@doi:10.1186/1471-2156-13-49] |
| DNA My Dog Essential Breed ID Test PLUS Wolf - Canid/Hybrid Test [@url:https://dnamydog.com/tests]             | $80-$130                   | Copy-number variation, number of markers not specified [@url:https://dnamydog.com/help/help-centre]                             | 350+ breeds [@url:https://dnamydog.com/science/breeds-we-test]                                                                                                              | Not specified                             |
| Accu-Metrics/Via-Pet Canine Breed Determination [@url:https://www.via-pet.com/canine-testing/p/dog-breed-identification] | $59                        | Not specified                                                                                                                   | 340 breeds [@url:https://www.via-pet.com/canine-testing/p/dog-breed-identification]                                       | Not specified                             |


As a positive control for the potential photographic test bias, we predicted the breed of each sample/photograph pair using a pre-trained convolutional neural network.
Dog breed classification is a classic problem in computer vision, and models trained on images from a large compendium (ImageNet) have been evaluated for their performance in classifying photographs of purebred dogs, with the model NASNet showing particularly robust performance [@doi:10.1007/s11633-020-1261-0; @doi:10.1109/sisy.2018.8524715; @doi:10.1109/iciteed.2019.8929955].
Therefore, NASNet complements DTC genetic testing results by predicting breeds based exclusively on photographs.
We loaded the NASNet model **nasnetalarge** from the Python package PyTorch Image Models (timm version 0.6.12) [@url:https://github.com/rwightman/pytorch-image-models] and used to classify each of the dog photos by adapting code from a tutorial [@url:https://rwightman.github.io/pytorch-image-models/models/inception-resnet-v2].
Because the classifier estimates many categories with a very long tail, only hits with a score greater than 1% were included in the analysis.

To evaluate whether swapping the photographs affected breed prediction for each DTC test, the proportion of results matching the registered breed across the two conditions was compared by calculating the odds ratio.
In cases where a test had either zero matching or zero non-matching predictions within a condition (i.e., one or more zero cells), the Haldane-Anscombe correction [@doi:10.1081/sac-200040691] was applied per [@doi:10.1002/jrsm.1460; @doi:10.15678/znuek.2015.0941.0504].
We evaluated independence between the treatment and control conditions using a one-tailed hypergeometric test.
Rejection of the null would indicate a potential relationship between the treatment (photograph matching status) and outcome.
Both statistical tests were conducted in R using the package vcd [@doi:10.18637/jss.v017.i03; @doi:10.1198/106186007X237856].

Based on qualitative patterns observed in the results, the decision was made *post hoc* to compare the phylogenetic clade [@doi:10.1016/j.celrep.2017.03.079] of each predicted breed against the registered breeds of the DNA donor and photographed dog.
Each breed was mapped onto a clade, as identified by [@doi:10.1016/j.celrep.2017.03.079] or, for breeds that were not included in that analysis, based on its closest genetic relationship to breeds assigned to clades.
In the treatment condition, each predicted breed's clade was compared to the clades of the DNA donor versus the dog whose photograph was provided to the testing company.
In the control condition, each dog was paired with another dog (based on the order in which they were recruited) to provide a random baseline.
The breed predictions were then evaluated to determine whether their clade matched the clade of the photographed or paired dog in the treatment and control conditions, respectively.
The goal of this analysis was to evaluate whether results that matched neither the registered breed of the DNA donor nor the photograph provided were closely related to, but not identical to, the photographed dog.
The odds ratio and hypergeometric tests were applied using the vcd package in R.
Additionally, the results at the level of breed clade were plotted in R using the ternary package [@doi:10.5281/zenodo.1068996].
Qualitative results (e.g., range-format percentages) were converted to numerical values for the purposes of this visualization (Supplementary Table XX).

